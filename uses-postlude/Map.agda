--{-# OPTIONS -v profile:10 #-}
open import Agda.Builtin.Reflection
open import Postlude
module Map {ğ‘²} {K : Set ğ‘²}     â¦ƒ isDecEquivalence/K : Eq K â¦„
           {ğ‘½} (V : K â†’ Set ğ‘½) â¦ƒ isDecEquivalence/V : {k : K} â†’ Eq (V k) â¦„
           (let ğ‘²ğ‘½ = ğ‘² âŠ”â‚— ğ‘½ ; ğ‘²ğ‘½â‚ = sucâ‚— ğ‘²ğ‘½)
           (Carrier : â„• â†’ Set ğ‘²ğ‘½)
       where

open import Tactic.Reright

record Map : Set ğ‘²ğ‘½â‚ where
  field
    _âˆˆ_ : âˆ€ {s} â†’ K â†’ Carrier s â†’ Set ğ‘²ğ‘½

  _âˆ‰_ : âˆ€ {s} â†’ K â†’ Carrier s â†’ Set ğ‘²ğ‘½
  _âˆ‰_ k m = Â¬ k âˆˆ m

  field
    âˆ…-is-empty : âˆ€ {ğ‘˜} {âˆ… : Carrier 0} â†’ ğ‘˜ âˆ‰ âˆ…
    get : âˆ€ {k : K} {s} {m : Carrier s} â†’ k âˆˆ m â†’ V k
    get-is-unique : âˆ€ {k : K} {s} {m : Carrier s} â†’ {kâˆˆmÂ¹ : k âˆˆ m} {kâˆˆmÂ² : k âˆˆ m} â†’ get kâˆˆmÂ¹ â‰¡ get kâˆˆmÂ²

  infixl 40 _âŠ†_
  _âŠ†_ : âˆ€ {sâ‚€ sâ‚} â†’ Carrier sâ‚€ â†’ Carrier sâ‚ â†’ Set ğ‘²ğ‘½
  _âŠ†_ mâ‚€ mâ‚ = âˆ€ {ğ‘˜} â†’ (ğ‘˜âˆˆmâ‚€ : ğ‘˜ âˆˆ mâ‚€) â†’ âˆƒ Î» ğ‘˜âˆˆmâ‚ â†’ get ğ‘˜âˆˆmâ‚€ â‰¡ get {m = mâ‚} ğ‘˜âˆˆmâ‚

  infixl 40 _âŠ‚_âˆ£_
  _âŠ‚_âˆ£_ : âˆ€ {sâ‚€ sâ‚} â†’ Carrier sâ‚€ â†’ Carrier sâ‚ â†’ (K â†’ Set ğ‘²) â†’ Set ğ‘²ğ‘½
  _âŠ‚_âˆ£_ mâ‚€ mâ‚ c = âˆ€ {ğ‘˜} â†’ c ğ‘˜ â†’ (ğ‘˜âˆˆmâ‚€ : ğ‘˜ âˆˆ mâ‚€) â†’ âˆƒ Î» (ğ‘˜âˆˆmâ‚ : ğ‘˜ âˆˆ mâ‚) â†’ get ğ‘˜âˆˆmâ‚€ â‰¡ get ğ‘˜âˆˆmâ‚

  field
    put : âˆ€ {kâ‚ : K} (vâ‚ : V kâ‚) {sâ‚€} {mâ‚€ : Carrier sâ‚€} â†’ kâ‚ âˆ‰ mâ‚€ â†’ âˆƒ Î» (mâ‚ : Carrier (suc sâ‚€)) â†’ âˆƒ Î» (kâ‚âˆˆmâ‚ : kâ‚ âˆˆ mâ‚) â†’ get kâ‚âˆˆmâ‚ â‰¡ vâ‚ Ã— mâ‚€ âŠ† mâ‚ Ã— mâ‚ âŠ‚ mâ‚€ âˆ£ (_â‰¢ kâ‚)
    _âˆˆ?_ : âˆ€ {s} â†’ (k : K) (m : Carrier s) â†’ Dec (k âˆˆ m)
    choose : âˆ€ {s} â†’ (m : Carrier s) â†’ Dec (âˆƒ Î» k â†’ k âˆˆ m)
    pick : âˆ€ {kâ‚ : K} {sâ‚€} {mâ‚ : Carrier (suc sâ‚€)} â†’ kâ‚ âˆˆ mâ‚ â†’ âˆƒ Î» (mâ‚€ : Carrier sâ‚€) â†’ mâ‚€ âŠ† mâ‚ Ã— (mâ‚ âŠ‚ mâ‚€ âˆ£ (_â‰¢ kâ‚)) Ã— kâ‚ âˆ‰ mâ‚€
{-
  private
    infixl 10 _â‰«=_
    _â‰«=_ : âˆ€ {ğ‘˜}
              {s/x}
              {s/y}
              {s/z}
              {x : Carrier s/x}
              {y : Carrier s/y}
              {z : Carrier s/z}
              {ğ‘˜âˆˆx : ğ‘˜ âˆˆ x}
              (Î£ğ‘˜âˆˆy : âˆƒ Î» ğ‘˜âˆˆy â†’ get ğ‘˜âˆˆx â‰¡ get ğ‘˜âˆˆy)
              (ğ‘˜âˆˆyâ†’Î£ğ‘˜âˆˆz : (ğ‘˜âˆˆy : ğ‘˜ âˆˆ y) â†’ âˆƒ Î» ğ‘˜âˆˆz â†’ get ğ‘˜âˆˆy â‰¡ get {m = z} ğ‘˜âˆˆz)
            â†’ âˆƒ Î» ğ‘˜âˆˆz â†’ get ğ‘˜âˆˆx â‰¡ get ğ‘˜âˆˆz
    (ğ‘˜âˆˆy , xáµâ‰¡yáµ) â‰«= ğ‘˜âˆˆyâ†’Î£ğ‘˜âˆˆz
     with ğ‘˜âˆˆyâ†’Î£ğ‘˜âˆˆz ğ‘˜âˆˆy
    ... | (ğ‘˜âˆˆz , yáµâ‰¡záµ) = ğ‘˜âˆˆz , (xáµâ‰¡yáµ âŸ¨â‰¡âŸ© yáµâ‰¡záµ)

    _âŸ¨âŠ†âŸ©_ : âˆ€ {s/x}
              {s/y}
              {s/z}
              {x : Carrier s/x}
              {y : Carrier s/y}
              {z : Carrier s/z}
              (xâŠ†y : x âŠ† y)
              (yâŠ†z : y âŠ† z)
              â†’ x âŠ† z
    xâŠ†y âŸ¨âŠ†âŸ© yâŠ†z = _â‰«= yâŠ†z âˆ˜ xâŠ†y

  record âŸ¦_âˆª_âŸ§ {s/â—­ s/â—®} (â—­ : Carrier s/â—­) (â—® : Carrier s/â—®) : Set ğ‘²ğ‘½ where
    constructor âŸª_,_,_âŸ«
    field
      {s/â–²} : â„•
      {â–²} : Carrier s/â–²
      â—­âŠ†â–² : â—­ âŠ† â–²
      â—®âŠ†â–² : â—® âŠ† â–²
      â–²âŠ†â—­âˆªâ—® : âˆ€ {k} â†’ k âˆˆ â–² â†’ (k âˆˆ â—­) âŠ (k âˆˆ â—®)

  [_âˆª_] : âˆ€ {s/â—­ s/â—®} (â—­ : Carrier s/â—­) (â—® : Carrier s/â—®) â†’ Dec âŸ¦ â—­ âˆª â—® âŸ§
  [_âˆª_] {0} â—­ â—® =
    yes record
      { â—­âŠ†â–² = Î» {ğ‘˜âˆˆâ‹† â†’ contradiction ğ‘˜âˆˆâ‹† âˆ…-is-empty}
      ; â—®âŠ†â–² = _, refl
      ; â–²âŠ†â—­âˆªâ—® = injâ‚‚ }
  [_âˆª_] {suc s/â—­â‚‹â‚} â—­ â—® =
    case choose â—­ of Î»
    { (yes (a , aâˆˆâ—­)) â†’
      let (â—­â‚‹â‚ , â—­â‚‹â‚âŠ†â—­ , â—­âŠ‚â—­â‚‹â‚|â‰¢a , aâˆ‰â—­â‚‹â‚) = pick aâˆˆâ—­ in
      case a âˆˆ? â—® of Î»
      { (no aâˆ‰â—®) â†’
        let (â—®â‚Šâ‚ , aâˆˆâ—®â‚Šâ‚ , â—®â‚Šâ‚áµƒ=â—­áµƒ , â—®âŠ†â—®â‚Šâ‚ , â—®â‚Šâ‚âŠ‚â—®|â‰¢a) = put (get aâˆˆâ—­) aâˆ‰â—® in
        case [ â—­â‚‹â‚ âˆª â—®â‚Šâ‚ ] of Î»
        { (yes âŸª â—­â‚‹â‚âŠ†â–² , â—®â‚Šâ‚âŠ†â–² , â–²âŠ†â—­â‚‹â‚âˆªâ—®â‚Šâ‚ âŸ«) â†’
          yes
          record
          { â—­âŠ†â–² =
            Î» {ğ‘˜} ğ‘˜âˆˆâ—­ â†’
            case ğ‘˜ â‰Ÿ a of Î»
            { (yes ğ‘˜â‰¡a) â†’
              reright ğ‘˜â‰¡a Î» _ â†’
              let (aâˆˆâ–² , â—®â‚Šâ‚áµƒ=â–²áµƒ) = â—®â‚Šâ‚âŠ†â–² aâˆˆâ—®â‚Šâ‚ in
              aâˆˆâ–² ,
              (get-is-unique âŸ¨â‰¡âŸ© â—®â‚Šâ‚áµƒ=â—­áµƒ Ê³âŸ¨â‰¡âŸ© â—®â‚Šâ‚áµƒ=â–²áµƒ)
            ; (no ğ‘˜â‰¢a) â†’ â—­âŠ‚â—­â‚‹â‚|â‰¢a ğ‘˜â‰¢a ğ‘˜âˆˆâ—­ â‰«= â—­â‚‹â‚âŠ†â–² }
          ; â—®âŠ†â–² = â—®âŠ†â—®â‚Šâ‚ âŸ¨âŠ†âŸ© â—®â‚Šâ‚âŠ†â–²
          ; â–²âŠ†â—­âˆªâ—® =
            Î» {ğ‘˜} ğ‘˜âˆˆâ–² â†’
            case â–²âŠ†â—­â‚‹â‚âˆªâ—®â‚Šâ‚ ğ‘˜âˆˆâ–² of Î»
            { (injâ‚ ğ‘˜âˆˆâ—­â‚‹â‚) â†’ injâ‚ âˆ˜â€² projâ‚ $ â—­â‚‹â‚âŠ†â—­ ğ‘˜âˆˆâ—­â‚‹â‚
            ; (injâ‚‚ ğ‘˜âˆˆâ—®â‚Šâ‚) â†’
              case ğ‘˜ â‰Ÿ a of Î»
              { (yes ğ‘˜â‰¡a) â†’ injâ‚ $ subst _ (sym ğ‘˜â‰¡a) aâˆˆâ—­
              ; (no ğ‘˜â‰¢a) â†’ injâ‚‚ âˆ˜â€² projâ‚ $ â—®â‚Šâ‚âŠ‚â—®|â‰¢a ğ‘˜â‰¢a ğ‘˜âˆˆâ—®â‚Šâ‚ } } }
        ; (no âˆ„â—­â‚‹â‚âˆªâ—®â‚Šâ‚) â†’
          no
          Î» { âŸª â—­âŠ†â–² , â—®âŠ†â–² , â–²âŠ†â—­âˆªâ—® âŸ« â†’
          flip contradiction
          âˆ„â—­â‚‹â‚âˆªâ—®â‚Šâ‚
          record
          { â—­âŠ†â–² = -- â—­â‚‹â‚ âŠ† â–²
            â—­â‚‹â‚âŠ†â—­ âŸ¨âŠ†âŸ© â—­âŠ†â–²
          ; â—®âŠ†â–² = -- â—®â‚Šâ‚ âŠ† â–²
            Î» {ğ‘˜} ğ‘˜âˆˆâ—®â‚Šâ‚ â†’
            case ğ‘˜ â‰Ÿ a of Î»
            { (yes ğ‘˜â‰¡a) â†’
              reright ğ‘˜â‰¡a Î» _ â†’
              let (aâˆˆâ–² , â—®áµƒ=â–²áµƒ) = â—­âŠ†â–² aâˆˆâ—­ in
              aâˆˆâ–² ,
              (get-is-unique âŸ¨â‰¡âŸ© â—®â‚Šâ‚áµƒ=â—­áµƒ âŸ¨â‰¡âŸ© â—®áµƒ=â–²áµƒ)
            ; (no ğ‘˜â‰¢a) â†’ â—®â‚Šâ‚âŠ‚â—®|â‰¢a ğ‘˜â‰¢a ğ‘˜âˆˆâ—®â‚Šâ‚ â‰«= â—®âŠ†â–² }
          ; â–²âŠ†â—­âˆªâ—® = -- â–² âŠ† â—­â‚‹â‚ âˆª â—®â‚Šâ‚
            Î» {ğ‘˜} ğ‘˜âˆˆâ–² â†’
            case â–²âŠ†â—­âˆªâ—® ğ‘˜âˆˆâ–² of Î»
            { (injâ‚ ğ‘˜âˆˆâ—­) â†’
              case ğ‘˜ â‰Ÿ a of Î»
              { (yes ğ‘˜â‰¡a) â†’ injâ‚‚ $ subst _ (sym ğ‘˜â‰¡a) aâˆˆâ—®â‚Šâ‚
              ; (no ğ‘˜â‰¢a) â†’ injâ‚ âˆ˜â€² projâ‚ $ â—­âŠ‚â—­â‚‹â‚|â‰¢a ğ‘˜â‰¢a ğ‘˜âˆˆâ—­ }
            ; (injâ‚‚ ğ‘˜âˆˆâ—®) â†’ injâ‚‚ âˆ˜â€² projâ‚ $ â—®âŠ†â—®â‚Šâ‚ ğ‘˜âˆˆâ—® } } } }
      ; (yes aâˆˆâ—®) â†’
        case get aâˆˆâ—­ â‰Ÿ get aâˆˆâ—® of Î»
        { (yes â—­áµƒ=â—®áµƒ) â†’
          case [ â—­â‚‹â‚ âˆª â—® ] of Î»
          { (yes âŸª â—­â‚‹â‚âŠ†â–² , â—®âŠ†â–² , â–²âŠ†â—­â‚‹â‚âˆªâ—® âŸ«) â†’
            yes
            âŸª (Î» {ğ‘˜} ğ‘˜âˆˆâ—­ â†’
              case ğ‘˜ â‰Ÿ a of Î»
              { (yes ğ‘˜â‰¡a) â†’
                reright ğ‘˜â‰¡a Î» _ â†’
                let (aâˆˆâ–² , â—®áµƒ=â–²áµƒ) = â—®âŠ†â–² aâˆˆâ—® in
                aâˆˆâ–² , (get-is-unique âŸ¨â‰¡âŸ© â—­áµƒ=â—®áµƒ âŸ¨â‰¡âŸ© â—®áµƒ=â–²áµƒ)
              ; (no ğ‘˜â‰¢a) â†’ â—­âŠ‚â—­â‚‹â‚|â‰¢a ğ‘˜â‰¢a ğ‘˜âˆˆâ—­ â‰«= â—­â‚‹â‚âŠ†â–² })
            , â—®âŠ†â–²
            , (Î» {ğ‘˜âˆˆâ–² â†’
              case â–²âŠ†â—­â‚‹â‚âˆªâ—® ğ‘˜âˆˆâ–² of Î»
              { (injâ‚ ğ‘˜âˆˆâ—­â‚‹â‚) â†’ injâ‚ âˆ˜â€² projâ‚ $ â—­â‚‹â‚âŠ†â—­ ğ‘˜âˆˆâ—­â‚‹â‚
              ; (injâ‚‚ ğ‘˜âˆˆâ—®) â†’ injâ‚‚ ğ‘˜âˆˆâ—® } }) âŸ«
          ; (no âˆ„â—­â‚‹â‚âˆªâ—®) â†’
            no
            Î» { âŸª â—­âŠ†â–² , â—®âŠ†â–² , â–²âŠ†â—­âˆªâ—® âŸ« â†’
            flip contradiction
            âˆ„â—­â‚‹â‚âˆªâ—®
            âŸª â—­â‚‹â‚âŠ†â—­ âŸ¨âŠ†âŸ© â—­âŠ†â–²
            , â—®âŠ†â–²
            , (Î» {ğ‘˜} ğ‘˜âˆˆâ–² â†’
              case â–²âŠ†â—­âˆªâ—® ğ‘˜âˆˆâ–² of Î»
              { (injâ‚ ğ‘˜âˆˆâ—­) â†’
                case ğ‘˜ â‰Ÿ a of Î»
                { (yes ğ‘˜â‰¡a) â†’ injâ‚‚ $ subst _ (sym ğ‘˜â‰¡a) aâˆˆâ—®
                ; (no ğ‘˜â‰¢a) â†’ injâ‚ âˆ˜â€² projâ‚ $ â—­âŠ‚â—­â‚‹â‚|â‰¢a ğ‘˜â‰¢a ğ‘˜âˆˆâ—­ }
              ; (injâ‚‚ ğ‘˜âˆˆâ—®) â†’ injâ‚‚ ğ‘˜âˆˆâ—® }) âŸ« } }
        ; (no â—­áµƒâ‰ â—®áµƒ) â†’
          no
          Î» { âŸª â—­âŠ†â–² , â—®âŠ†â–² , â–²âŠ†â—­âˆªâ—® âŸ« â†’
          flip contradiction
          â—­áµƒâ‰ â—®áµƒ
          (let â—­áµƒ=â–²áµƒ = projâ‚‚ (â—­âŠ†â–² aâˆˆâ—­)
               â—®áµƒ=â–²áµƒ = projâ‚‚ (â—®âŠ†â–² aâˆˆâ—®) in
          â—­áµƒ=â–²áµƒ âŸ¨â‰¡âŸ© get-is-unique âŸ¨â‰¡âŸ©Ê³ â—®áµƒ=â–²áµƒ) } } }
    ; (no âˆ„âˆˆâ—­) â†’
      yes
      âŸª (Î» {ğ‘˜} ğ‘˜âˆˆâ—­ â†’
        flip contradiction
        âˆ„âˆˆâ—­ $
        ğ‘˜ , ğ‘˜âˆˆâ—­)
      , _, refl
      , injâ‚‚ âŸ« }
-}

module _ (m : Map) where
  open Map m

  private
    infixl 10 _â‰«=_
    _â‰«=_ : âˆ€ {ğ‘˜}
              {s/x}
              {s/y}
              {s/z}
              {x : Carrier s/x}
              {y : Carrier s/y}
              {z : Carrier s/z}
              {ğ‘˜âˆˆx : ğ‘˜ âˆˆ x}
              (Î£ğ‘˜âˆˆy : âˆƒ Î» ğ‘˜âˆˆy â†’ get ğ‘˜âˆˆx â‰¡ get ğ‘˜âˆˆy)
              (ğ‘˜âˆˆyâ†’Î£ğ‘˜âˆˆz : (ğ‘˜âˆˆy : ğ‘˜ âˆˆ y) â†’ âˆƒ Î» ğ‘˜âˆˆz â†’ get ğ‘˜âˆˆy â‰¡ get {m = z} ğ‘˜âˆˆz)
            â†’ âˆƒ Î» ğ‘˜âˆˆz â†’ get ğ‘˜âˆˆx â‰¡ get ğ‘˜âˆˆz
    (ğ‘˜âˆˆy , xáµâ‰¡yáµ) â‰«= ğ‘˜âˆˆyâ†’Î£ğ‘˜âˆˆz
     with ğ‘˜âˆˆyâ†’Î£ğ‘˜âˆˆz ğ‘˜âˆˆy
    ... | (ğ‘˜âˆˆz , yáµâ‰¡záµ) = ğ‘˜âˆˆz , (xáµâ‰¡yáµ âŸ¨â‰¡âŸ© yáµâ‰¡záµ)

    _âŸ¨âŠ†âŸ©_ : âˆ€ {s/x}
              {s/y}
              {s/z}
              {x : Carrier s/x}
              {y : Carrier s/y}
              {z : Carrier s/z}
              (xâŠ†y : x âŠ† y)
              (yâŠ†z : y âŠ† z)
              â†’ x âŠ† z
    xâŠ†y âŸ¨âŠ†âŸ© yâŠ†z = _â‰«= yâŠ†z âˆ˜ xâŠ†y

  record âŸ¦_âˆª_âŸ§ {s/â—­ s/â—®} (â—­ : Carrier s/â—­) (â—® : Carrier s/â—®) : Set ğ‘²ğ‘½ where
    constructor âŸª_,_,_âŸ«
    field
      {s/â–²} : â„•
      {â–²} : Carrier s/â–²
      â—­âŠ†â–² : â—­ âŠ† â–²
      â—®âŠ†â–² : â—® âŠ† â–²
      â–²âŠ†â—­âˆªâ—® : âˆ€ {k} â†’ k âˆˆ â–² â†’ (k âˆˆ â—­) âŠ (k âˆˆ â—®)

  [_âˆª_] : âˆ€ {s/â—­ s/â—®} (â—­ : Carrier s/â—­) (â—® : Carrier s/â—®) â†’ Dec âŸ¦ â—­ âˆª â—® âŸ§
  [_âˆª_] {0} â—­ â—® =
    yes record
      { â—­âŠ†â–² = Î» {ğ‘˜âˆˆâ‹† â†’ âŠ¥-elim $ âˆ…-is-empty ğ‘˜âˆˆâ‹†}
      ; â—®âŠ†â–² = _, refl
      ; â–²âŠ†â—­âˆªâ—® = injâ‚‚ }
  [_âˆª_] {suc s/â—­â‚‹â‚} â—­ â—® =
    case choose â—­ of Î»
    { (yes (a , aâˆˆâ—­)) â†’
      let (â—­â‚‹â‚ , â—­â‚‹â‚âŠ†â—­ , â—­âŠ‚â—­â‚‹â‚|â‰¢a , aâˆ‰â—­â‚‹â‚) = pick aâˆˆâ—­ in
      case a âˆˆ? â—® of Î»
      { (no aâˆ‰â—®) â†’
        let (â—®â‚Šâ‚ , aâˆˆâ—®â‚Šâ‚ , â—®â‚Šâ‚áµƒ=â—­áµƒ , â—®âŠ†â—®â‚Šâ‚ , â—®â‚Šâ‚âŠ‚â—®|â‰¢a) = put (get aâˆˆâ—­) aâˆ‰â—® in
        case [ â—­â‚‹â‚ âˆª â—®â‚Šâ‚ ] of Î»
        { (yes âŸª â—­â‚‹â‚âŠ†â–² , â—®â‚Šâ‚âŠ†â–² , â–²âŠ†â—­â‚‹â‚âˆªâ—®â‚Šâ‚ âŸ«) â†’
          yes
          record
          { â—­âŠ†â–² =
            Î» {ğ‘˜} ğ‘˜âˆˆâ—­ â†’
            case ğ‘˜ â‰Ÿ a of Î»
            { (yes ğ‘˜â‰¡a) â†’
              reright ğ‘˜â‰¡a Î» _ â†’
              let (aâˆˆâ–² , â—®â‚Šâ‚áµƒ=â–²áµƒ) = â—®â‚Šâ‚âŠ†â–² aâˆˆâ—®â‚Šâ‚ in
              aâˆˆâ–² ,
              (get-is-unique âŸ¨â‰¡âŸ© â—®â‚Šâ‚áµƒ=â—­áµƒ Ê³âŸ¨â‰¡âŸ© â—®â‚Šâ‚áµƒ=â–²áµƒ)
            ; (no ğ‘˜â‰¢a) â†’ â—­âŠ‚â—­â‚‹â‚|â‰¢a ğ‘˜â‰¢a ğ‘˜âˆˆâ—­ â‰«= â—­â‚‹â‚âŠ†â–² }
          ; â—®âŠ†â–² = â—®âŠ†â—®â‚Šâ‚ âŸ¨âŠ†âŸ© â—®â‚Šâ‚âŠ†â–²
          ; â–²âŠ†â—­âˆªâ—® =
            Î» {ğ‘˜} ğ‘˜âˆˆâ–² â†’
            case â–²âŠ†â—­â‚‹â‚âˆªâ—®â‚Šâ‚ ğ‘˜âˆˆâ–² of Î»
            { (injâ‚ ğ‘˜âˆˆâ—­â‚‹â‚) â†’ injâ‚ âˆ˜â€² projâ‚ $ â—­â‚‹â‚âŠ†â—­ ğ‘˜âˆˆâ—­â‚‹â‚
            ; (injâ‚‚ ğ‘˜âˆˆâ—®â‚Šâ‚) â†’
              case ğ‘˜ â‰Ÿ a of Î»
              { (yes ğ‘˜â‰¡a) â†’ injâ‚ $ subst _ (sym ğ‘˜â‰¡a) aâˆˆâ—­
              ; (no ğ‘˜â‰¢a) â†’ injâ‚‚ âˆ˜â€² projâ‚ $ â—®â‚Šâ‚âŠ‚â—®|â‰¢a ğ‘˜â‰¢a ğ‘˜âˆˆâ—®â‚Šâ‚ } } }
        ; (no âˆ„â—­â‚‹â‚âˆªâ—®â‚Šâ‚) â†’
          no
          Î» { âŸª â—­âŠ†â–² , â—®âŠ†â–² , â–²âŠ†â—­âˆªâ—® âŸ« â†’
          flip contradiction
          âˆ„â—­â‚‹â‚âˆªâ—®â‚Šâ‚
          record
          { â—­âŠ†â–² = -- â—­â‚‹â‚ âŠ† â–²
            â—­â‚‹â‚âŠ†â—­ âŸ¨âŠ†âŸ© â—­âŠ†â–²
          ; â—®âŠ†â–² = -- â—®â‚Šâ‚ âŠ† â–²
            Î» {ğ‘˜} ğ‘˜âˆˆâ—®â‚Šâ‚ â†’
            case ğ‘˜ â‰Ÿ a of Î»
            { (yes ğ‘˜â‰¡a) â†’
              reright ğ‘˜â‰¡a Î» _ â†’
              let (aâˆˆâ–² , â—®áµƒ=â–²áµƒ) = â—­âŠ†â–² aâˆˆâ—­ in
              aâˆˆâ–² ,
              (get-is-unique âŸ¨â‰¡âŸ© â—®â‚Šâ‚áµƒ=â—­áµƒ âŸ¨â‰¡âŸ© â—®áµƒ=â–²áµƒ)
            ; (no ğ‘˜â‰¢a) â†’ â—®â‚Šâ‚âŠ‚â—®|â‰¢a ğ‘˜â‰¢a ğ‘˜âˆˆâ—®â‚Šâ‚ â‰«= â—®âŠ†â–² }
          ; â–²âŠ†â—­âˆªâ—® = -- â–² âŠ† â—­â‚‹â‚ âˆª â—®â‚Šâ‚
            Î» {ğ‘˜} ğ‘˜âˆˆâ–² â†’
            case â–²âŠ†â—­âˆªâ—® ğ‘˜âˆˆâ–² of Î»
            { (injâ‚ ğ‘˜âˆˆâ—­) â†’
              case ğ‘˜ â‰Ÿ a of Î»
              { (yes ğ‘˜â‰¡a) â†’ injâ‚‚ $ subst _ (sym ğ‘˜â‰¡a) aâˆˆâ—®â‚Šâ‚
              ; (no ğ‘˜â‰¢a) â†’ injâ‚ âˆ˜â€² projâ‚ $ â—­âŠ‚â—­â‚‹â‚|â‰¢a ğ‘˜â‰¢a ğ‘˜âˆˆâ—­ }
            ; (injâ‚‚ ğ‘˜âˆˆâ—®) â†’ injâ‚‚ âˆ˜â€² projâ‚ $ â—®âŠ†â—®â‚Šâ‚ ğ‘˜âˆˆâ—® } } } }
      ; (yes aâˆˆâ—®) â†’
        case get aâˆˆâ—­ â‰Ÿ get aâˆˆâ—® of Î»
        { (yes â—­áµƒ=â—®áµƒ) â†’
          case [ â—­â‚‹â‚ âˆª â—® ] of Î»
          { (yes âŸª â—­â‚‹â‚âŠ†â–² , â—®âŠ†â–² , â–²âŠ†â—­â‚‹â‚âˆªâ—® âŸ«) â†’
            yes
            âŸª (Î» {ğ‘˜} ğ‘˜âˆˆâ—­ â†’
              case ğ‘˜ â‰Ÿ a of Î»
              { (yes ğ‘˜â‰¡a) â†’
                reright ğ‘˜â‰¡a Î» _ â†’
                let (aâˆˆâ–² , â—®áµƒ=â–²áµƒ) = â—®âŠ†â–² aâˆˆâ—® in
                aâˆˆâ–² , (get-is-unique âŸ¨â‰¡âŸ© â—­áµƒ=â—®áµƒ âŸ¨â‰¡âŸ© â—®áµƒ=â–²áµƒ)
              ; (no ğ‘˜â‰¢a) â†’ â—­âŠ‚â—­â‚‹â‚|â‰¢a ğ‘˜â‰¢a ğ‘˜âˆˆâ—­ â‰«= â—­â‚‹â‚âŠ†â–² })
            , â—®âŠ†â–²
            , (Î» {ğ‘˜âˆˆâ–² â†’
              case â–²âŠ†â—­â‚‹â‚âˆªâ—® ğ‘˜âˆˆâ–² of Î»
              { (injâ‚ ğ‘˜âˆˆâ—­â‚‹â‚) â†’ injâ‚ âˆ˜â€² projâ‚ $ â—­â‚‹â‚âŠ†â—­ ğ‘˜âˆˆâ—­â‚‹â‚
              ; (injâ‚‚ ğ‘˜âˆˆâ—®) â†’ injâ‚‚ ğ‘˜âˆˆâ—® } }) âŸ«
          ; (no âˆ„â—­â‚‹â‚âˆªâ—®) â†’
            no
            Î» { âŸª â—­âŠ†â–² , â—®âŠ†â–² , â–²âŠ†â—­âˆªâ—® âŸ« â†’
            flip contradiction
            âˆ„â—­â‚‹â‚âˆªâ—®
            âŸª â—­â‚‹â‚âŠ†â—­ âŸ¨âŠ†âŸ© â—­âŠ†â–²
            , â—®âŠ†â–²
            , (Î» {ğ‘˜} ğ‘˜âˆˆâ–² â†’
              case â–²âŠ†â—­âˆªâ—® ğ‘˜âˆˆâ–² of Î»
              { (injâ‚ ğ‘˜âˆˆâ—­) â†’
                case ğ‘˜ â‰Ÿ a of Î»
                { (yes ğ‘˜â‰¡a) â†’ injâ‚‚ $ subst _ (sym ğ‘˜â‰¡a) aâˆˆâ—®
                ; (no ğ‘˜â‰¢a) â†’ injâ‚ âˆ˜â€² projâ‚ $ â—­âŠ‚â—­â‚‹â‚|â‰¢a ğ‘˜â‰¢a ğ‘˜âˆˆâ—­ }
              ; (injâ‚‚ ğ‘˜âˆˆâ—®) â†’ injâ‚‚ ğ‘˜âˆˆâ—® }) âŸ« } }
        ; (no â—­áµƒâ‰ â—®áµƒ) â†’
          no
          Î» { âŸª â—­âŠ†â–² , â—®âŠ†â–² , â–²âŠ†â—­âˆªâ—® âŸ« â†’
          flip contradiction
          â—­áµƒâ‰ â—®áµƒ
          (let â—­áµƒ=â–²áµƒ = projâ‚‚ (â—­âŠ†â–² aâˆˆâ—­)
               â—®áµƒ=â–²áµƒ = projâ‚‚ (â—®âŠ†â–² aâˆˆâ—®) in
          â—­áµƒ=â–²áµƒ âŸ¨â‰¡âŸ© get-is-unique âŸ¨â‰¡âŸ©Ê³ â—®áµƒ=â–²áµƒ) } } }
    ; (no âˆ„âˆˆâ—­) â†’
      yes
      âŸª (Î» {ğ‘˜} ğ‘˜âˆˆâ—­ â†’
        flip contradiction
        âˆ„âˆˆâ—­ $
        ğ‘˜ , ğ‘˜âˆˆâ—­)
      , _, refl
      , injâ‚‚ âŸ« }
